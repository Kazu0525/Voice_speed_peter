<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TypeVoice Analytics - 音声入力・タイピング生産性測定ツール</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 20px;
}

.container {
max-width: 1200px;
margin: 0 auto;
background: white;
border-radius: 20px;
box-shadow: 0 20px 40px rgba(0,0,0,0.1);
overflow: hidden;
}

.header {
background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
color: white;
padding: 30px;
text-align: center;
}

.header h1 {
font-size: 2.5rem;
margin-bottom: 10px;
font-weight: 700;
}

.header p {
font-size: 1.1rem;
opacity: 0.9;
}

.main-content {
padding: 40px;
}

.test-section {
background: #f8fafc;
border-radius: 15px;
padding: 30px;
margin-bottom: 30px;
border: 2px solid #e2e8f0;
transition: all 0.3s ease;
}

.test-section:hover {
border-color: #4f46e5;
box-shadow: 0 10px 25px rgba(79, 70, 229, 0.1);
}

.test-section h2 {
color: #1e293b;
font-size: 1.8rem;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.test-icon {
width: 30px;
height: 30px;
background: linear-gradient(135deg, #4f46e5, #7c3aed);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: bold;
}

.sample-text {
background: white;
border: 2px solid #e2e8f0;
border-radius: 10px;
padding: 20px;
margin-bottom: 20px;
font-size: 1.1rem;
line-height: 1.6;
box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.input-area {
width: 100%;
min-height: 120px;
border: 2px solid #e2e8f0;
border-radius: 10px;
padding: 15px;
font-size: 1rem;
font-family: inherit;
resize: vertical;
transition: border-color 0.3s ease;
}

.input-area:focus {
outline: none;
border-color: #4f46e5;
box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.controls {
display: flex;
gap: 15px;
margin-top: 20px;
flex-wrap: wrap;
}

.btn {
padding: 12px 24px;
border: none;
border-radius: 8px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 8px;
}

.btn-primary {
background: linear-gradient(135deg, #4f46e5, #7c3aed);
color: white;
}

.btn-primary:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
}

.btn-secondary {
background: #f1f5f9;
color: #475569;
border: 2px solid #e2e8f0;
}

.btn-secondary:hover {
background: #e2e8f0;
}

.btn-danger {
background: #ef4444;
color: white;
}

.btn-danger:hover {
background: #dc2626;
}

.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.timer {
font-size: 2rem;
font-weight: bold;
text-align: center;
margin: 20px 0;
color: #4f46e5;
}

.countdown {
font-size: 3rem;
color: #ef4444;
}

.results {
background: linear-gradient(135deg, #10b981, #059669);
color: white;
border-radius: 15px;
padding: 25px;
margin-top: 20px;
display: none;
}

.results h3 {
font-size: 1.5rem;
margin-bottom: 15px;
text-align: center;
}

.results-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
}

.result-item {
background: rgba(255,255,255,0.2);
padding: 15px;
border-radius: 10px;
text-align: center;
}

.result-value {
font-size: 2rem;
font-weight: bold;
margin-bottom: 5px;
}

.result-label {
font-size: 0.9rem;
opacity: 0.9;
}

.comparison {
background: #fef3c7;
border: 2px solid #f59e0b;
border-radius: 15px;
padding: 25px;
margin-top: 30px;
display: none;
}

.comparison h3 {
color: #92400e;
font-size: 1.5rem;
margin-bottom: 15px;
text-align: center;
}

.voice-support {
background: #dbeafe;
border: 2px solid #3b82f6;
border-radius: 10px;
padding: 15px;
margin-bottom: 20px;
}

.voice-support p {
color: #1e40af;
font-weight: 500;
}

.status-indicator {
display: inline-block;
width: 12px;
height: 12px;
border-radius: 50%;
margin-right: 8px;
}

.status-ready { background-color: #10b981; }
.status-recording { background-color: #ef4444; animation: pulse 1s infinite; }
.status-processing { background-color: #f59e0b; }

@keyframes pulse {
0% { opacity: 1; }
50% { opacity: 0.5; }
100% { opacity: 1; }
}

.progress-bar {
width: 100%;
height: 8px;
background-color: #e2e8f0;
border-radius: 4px;
overflow: hidden;
margin: 10px 0;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #4f46e5, #7c3aed);
width: 0%;
transition: width 0.1s ease;
}

@media (max-width: 768px) {
.header h1 {
font-size: 2rem;
}

.main-content {
padding: 20px;
}

.controls {
flex-direction: column;
}

.btn {
justify-content: center;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>🎯 TypeVoice Analytics</h1>
<p>音声入力とタイピングの生産性を科学的に測定・比較</p>
</div>

<div class="main-content">
<!-- 音声入力テスト -->
<div class="test-section">
<h2>
<div class="test-icon">🎤</div>
音声入力テスト
</h2>

<div class="voice-support">
<p>
<span class="status-indicator status-ready" id="voiceStatus"></span>
📢 ブラウザのマイク許可が必要です。「マイクの認証」ボタンを押すと許可を求められます。
</p>
</div>

<button class="btn btn-primary" id="micAuthBtn">マイクの認証</button>
<p id="micAuthStatus"></p>

<div class="sample-text" id="voiceSampleText">
課題文がここに表示されます...
</div>

<textarea class="input-area" id="voiceInput"
placeholder="音声入力結果がここに表示されます（手動編集も可能）..."></textarea>

<div class="progress-bar">
<div class="progress-fill" id="voiceProgress"></div>
</div>

<div class="timer" id="voiceTimer">準備完了</div>

<div class="controls">
<button class="btn btn-primary" id="voiceStartBtn">
🎤 開始
</button>
<button class="btn btn-danger" id="voiceStopBtn" style="display: none;">
⏹️ 停止
</button>
<button class="btn btn-secondary" id="voiceResetBtn">
🔄 リセット
</button>
</div>

<div class="results" id="voiceResults">
<h3>🎤 音声入力テスト結果</h3>
<div class="results-grid">
<div class="result-item">
<div class="result-value" id="voiceSpeed">0</div>
<div class="result-label">文字/分</div>
</div>
<div class="result-item">
<div class="result-value" id="voiceAccuracy">0%</div>
<div class="result-label">正確率</div>
</div>
<div class="result-item">
<div class="result-value" id="voiceErrors">0</div>
<div class="result-label">誤認識数</div>
</div>
</div>
</div>
</div>

<!-- タイピングテスト -->
<div class="test-section">
<h2>
<div class="test-icon">⌨️</div>
タイピングテスト
</h2>

<div class="sample-text" id="typingSampleText">
課題文がここに表示されます...
</div>

<textarea class="input-area" id="typingInput"
placeholder="ここにタイピングしてください..."></textarea>

<div class="progress-bar">
<div class="progress-fill" id="typingProgress"></div>
</div>

<div class="timer" id="typingTimer">準備完了</div>

<div class="controls">
<button class="btn btn-primary" id="typingStartBtn">
⌨️ 開始
</button>
<button class="btn btn-danger" id="typingStopBtn" style="display: none;">
⏹️ 停止
</button>
<button class="btn btn-secondary" id="typingResetBtn">
🔄 リセット
</button>
</div>

<div class="results" id="typingResults">
<h3>⌨️ タイピングテスト結果</h3>
<div class="results-grid">
<div class="result-item">
<div class="result-value" id="typingSpeed">0</div>
<div class="result-label">文字/分</div>
</div>
<div class="result-item">
<div class="result-value" id="typingAccuracy">0%</div>
<div class="result-label">正確率</div>
</div>
<div class="result-item">
<div class="result-value" id="typingErrors">0</div>
<div class="result-label">誤入力数</div>
</div>
</div>
</div>
</div>

<!-- 比較結果 -->
<div class="comparison" id="comparison">
<h3>📊 音声入力 vs タイピング 比較結果</h3>
<div id="comparisonContent">
両方のテストを完了すると、詳細な比較結果を表示します。
</div>
</div>
</div>
</div>

<script>
// サンプルテキスト（1800文字程度）
const sampleTexts = [
"本日の会議では、来四半期の売上目標について議論しました。営業部門からは前年同期比15%増の目標設定が提案され、マーケティング部門との連携強化が重要であることが確認されました。特に新規顧客開拓において、デジタルマーケティングの活用とセールス担当者のスキルアップが急務となっています。今後のアクションプランとして、月次の進捗レビュー会議を設定し、各部門の責任者が参加することで、目標達成に向けた具体的な施策を検討していきます。また、競合他社の動向分析も並行して実施し、市場環境の変化に迅速に対応できる体制を構築します。プロジェクト管理の効率化を図るため、新しいタスク管理システムの導入を検討しており、チーム間の情報共有をより円滑にする仕組みづくりを進めています。顧客満足度の向上を目指し、アフターサービス体制の見直しと改善提案を行い、長期的な信頼関係の構築に努めています。市場調査の結果、競合他社に対する優位性を保つため、技術革新への投資と人材育成の強化が不可欠であることが判明しました。来期に向けた戦略策定では、持続可能な成長モデルの構築と、グローバル展開を視野に入れた事業計画の立案を重点的に取り組んでいきます。社内のデジタル化推進により、業務プロセスの自動化と効率化を実現し、従業員の働き方改革にも貢献していく予定です。クライアントからのフィードバックを積極的に収集し、サービス品質の継続的な改善に取り組むことで、市場での競争力を維持強化していきます。",

"プロジェクト管理において最も重要なのは、ステークホルダー間のコミュニケーションです。チーム内での情報共有を円滑にするため、週次のスタンドアップミーティングと月次のスプリントレビューを実施しています。また、リスク管理の観点から、潜在的な課題の早期発見と対策立案に注力しており、品質保証体制の強化も同時に進めています。納期遵守とコスト最適化のバランスを取りながら、クライアントの要求仕様を満たす成果物の提供を目指しています。今後は自動化ツールの導入により、作業効率の向上と人的ミスの削減を図る予定です。開発チームでは、アジャイル開発手法を採用し、短期間でのイテレーション開発により、顧客ニーズに迅速に対応できる体制を構築しています。品質管理においては、継続的インテグレーションとテスト自動化により、バグの早期発見と修正を実現しています。プロジェクトの進捗状況は、ダッシュボードを活用してリアルタイムで可視化し、関係者全員が常に最新の状況を把握できるようにしています。チームメンバーのスキル向上を支援するため、定期的な研修プログラムと外部セミナーへの参加を奨励し、技術力の底上げを図っています。クライアントとの密接な連携により、要求仕様の変更にも柔軟に対応し、最終的な成果物の品質向上に努めています。プロジェクトの成功要因を分析し、ベストプラクティスとして組織全体で共有することで、今後のプロジェクト実行能力の向上を目指しています。",

"企業のデジタルトランスフォーメーション推進において、従業員のITリテラシー向上は不可欠な要素です。研修プログラムの充実化と実践的なスキル習得機会の提供により、組織全体の生産性向上を図っています。クラウドサービスの活用とセキュリティ対策の両立、そしてデータ分析能力の強化が今後の競争優位性を左右する重要なファクターとなります。また、リモートワーク環境下でのコラボレーション促進のため、各種コミュニケーションツールの導入と運用ルールの整備を進めており、働き方改革の実現に向けた取り組みを継続的に実施しています。人工知能とビッグデータ活用による業務自動化の推進により、従来の手作業による処理時間を大幅に短縮し、より創造的な業務に集中できる環境を整備しています。サイバーセキュリティ対策の強化では、多層防御システムの構築と従業員への継続的なセキュリティ教育により、情報資産の保護に万全を期しています。モバイルファーストの戦略により、いつでもどこでも業務を継続できる柔軟な働き方を実現し、ワークライフバランスの改善にも貢献しています。データドリブンな意思決定を支援するため、各種KPIの可視化と分析ツールの導入により、経営判断の精度向上を図っています。顧客体験の向上を目指し、オムニチャネル戦略の展開により、あらゆるタッチポイントでの一貫したサービス提供を実現しています。持続可能な成長を支えるため、環境負荷の軽減とコスト削減を両立させる革新的なテクノロジーの導入を積極的に推進しています。"
];

// グローバル変数
let currentSampleText = '';
let voiceTestActive = false;
let typingTestActive = false;
let voiceStartTime = 0;
let typingStartTime = 0;
let voiceResults = null;
let typingResults = null;
let voiceInterval = null;
let typingInterval = null;
let microphonePermissionGranted = false;

// マイクの認証状態を保存する
function isMicPreviouslyGranted() {
return localStorage.getItem('micGranted') === 'true';
}

function setMicGranted() {
localStorage.setItem('micGranted', 'true');
}

// 初期化
async function init() {
currentSampleText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
document.getElementById('voiceSampleText').textContent = currentSampleText;
document.getElementById('typingSampleText').textContent = currentSampleText;

setupEventListeners();

// 保存状態により表示を変える
if (isMicPreviouslyGranted()) {
microphonePermissionGranted = true;
updateVoiceStatus('ready');
document.getElementById('micAuthStatus').textContent = '✅ すでにマイクの許可は完了しています。';
document.querySelector('.voice-support p').innerHTML = `
<span class="status-indicator status-ready" id="voiceStatus"></span>
✅ マイクは認証済みです。外部ツールをご使用ください。
`;
}
}

// マイク許可の事前確認
async function handleMicAuth() {
const statusEl = document.getElementById('micAuthStatus');

if (isMicPreviouslyGranted()) {
statusEl.innerText = '✅ すでにマイクの許可は完了しています。';
microphonePermissionGranted = true;
return;
}

try {
const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
stream.getTracks().forEach(track => track.stop());

setMicGranted();
microphonePermissionGranted = true;
statusEl.innerText = '✅ マイクが許可されました。外部ツールで音声入力してください。';
updateVoiceStatus('ready');
document.querySelector('.voice-support p').innerHTML = `
<span class="status-indicator status-ready" id="voiceStatus"></span>
✅ マイク認証済みです。Windows音声入力や外部ツールをご使用ください。
`;
} catch (err) {
microphonePermissionGranted = false;
statusEl.innerHTML = `
❌ マイクの許可がされませんでした。<br>
この機能を使うには許可が必要です。<br>
<button class="btn btn-secondary" onclick="alert('ブラウザの設定からマイクを許可してください')">🔧 設定を開く</button>
`;
}
}

// イベントリスナーの設定
function setupEventListeners() {
document.getElementById('micAuthBtn').addEventListener('click', handleMicAuth);
document.getElementById('voiceStartBtn').addEventListener('click', startVoiceTest);
document.getElementById('voiceStopBtn').addEventListener('click', endVoiceTest);
document.getElementById('voiceResetBtn').addEventListener('click', resetVoiceTest);

document.getElementById('typingStartBtn').addEventListener('click', startTypingTest);
document.getElementById('typingStopBtn').addEventListener('click', endTypingTest);
document.getElementById('typingResetBtn').addEventListener('click', resetTypingTest);
}

// 音声認識ステータス更新
function updateVoiceStatus(status) {
const statusElement = document.getElementById('voiceStatus');
statusElement.className = `status-indicator status-${status}`;
}

// 音声テスト開始（修正版）
async function startVoiceTest() {
if (!isMicPreviouslyGranted()) {
alert('先に「マイクの認証」を押して許可を与えてください。');
return;
}

// 認識開始処理は不要、ユーザーがOSツールで入力する前提
document.getElementById('voiceInput').value = '';
document.getElementById('voiceResults').style.display = 'none';
document.getElementById('voiceStartBtn').style.display = 'none';
document.getElementById('voiceStopBtn').style.display = 'inline-flex';

startCountdown('voice', () => {
voiceTestActive = true;
voiceStartTime = Date.now();
document.getElementById('voiceInput').readOnly = false;
startTimer('voice');
startProgress('voice');

setTimeout(() => {
if (voiceTestActive) {
endVoiceTest();
}
}, 60000);
});
}

// 音声テスト終了
function endVoiceTest() {
if (!voiceTestActive) return;

voiceTestActive = false;

if (voiceInterval) {
clearInterval(voiceInterval);
}

// 中間結果タグを削除してクリーンアップ
const voiceInput = document.getElementById('voiceInput');
voiceInput.value = voiceInput.value.replace(/\[中間\].*$/, '');
voiceInput.readOnly = true;

const endTime = Date.now();
const duration = (endTime - voiceStartTime) / 1000;
const inputText = voiceInput.value;

voiceResults = calculateResults(inputText, currentSampleText, duration);
displayResults('voice', voiceResults);

document.getElementById('voiceStartBtn').style.display = 'inline-flex';
document.getElementById('voiceStopBtn').style.display = 'none';
document.getElementById('voiceTimer').textContent = '完了';

updateVoiceStatus('ready');
checkComparison();
}

// タイピングテスト開始
function startTypingTest() {
document.getElementById('typingInput').value = '';
document.getElementById('typingResults').style.display = 'none';
document.getElementById('typingStartBtn').style.display = 'none';
document.getElementById('typingStopBtn').style.display = 'inline-flex';

startCountdown('typing', () => {
typingTestActive = true;
typingStartTime = Date.now();
document.getElementById('typingInput').readOnly = false;
document.getElementById('typingInput').focus();
startTimer('typing');
startProgress('typing');

// 1分後に自動終了
setTimeout(() => {
if (typingTestActive) {
endTypingTest();
}
}, 60000);
});
}

// タイピングテスト終了（改良版）
function endTypingTest() {
if (!typingTestActive) return;

typingTestActive = false;

if (typingInterval) {
clearInterval(typingInterval);
}

// 入力を確定させる
const typingInput = document.getElementById('typingInput');
typingInput.blur(); // フォーカスを外して入力を確定

setTimeout(() => {
typingInput.readOnly = true;

const endTime = Date.now();
const duration = (endTime - typingStartTime) / 1000;
const inputText = typingInput.value;

typingResults = calculateResults(inputText, currentSampleText, duration);
displayResults('typing', typingResults);

document.getElementById('typingStartBtn').style.display = 'inline-flex';
document.getElementById('typingStopBtn').style.display = 'none';
document.getElementById('typingTimer').textContent = '完了';

checkComparison();
}, 100); // 少し待って入力確定を確実にする
}

// プログレスバー開始
function startProgress(type) {
const progressElement = document.getElementById(type + 'Progress');
let progress = 0;

const progressInterval = setInterval(() => {
if ((type === 'voice' && !voiceTestActive) || (type === 'typing' && !typingTestActive)) {
clearInterval(progressInterval);
progressElement.style.width = '100%';
return;
}

progress += 100/60; // 60秒で100%
progressElement.style.width = Math.min(progress, 100) + '%';

if (progress >= 100) {
clearInterval(progressInterval);
}
}, 1000);
}

// カウントダウン（改良版）
function startCountdown(type, callback) {
let count = 3;
const timerElement = document.getElementById(type + 'Timer');

const countdownInterval = setInterval(() => {
timerElement.textContent = `開始まで${count}秒`;
timerElement.className = 'timer countdown';

count--;

if (count < 0) {
clearInterval(countdownInterval);
timerElement.className = 'timer';
timerElement.textContent = 'スタート！';

setTimeout(() => {
callback();
}, 500);
}
}, 1000);
}

// タイマー
function startTimer(type) {
const timerElement = document.getElementById(type + 'Timer');
let seconds = 60;

const interval = setInterval(() => {
const minutes = Math.floor(seconds / 60);
const remainingSeconds = seconds % 60;
timerElement.textContent = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;

seconds--;

if (seconds < 0 || (type === 'voice' && !voiceTestActive) || (type === 'typing' && !typingTestActive)) {
clearInterval(interval);
}
}, 1000);

if (type === 'voice') {
voiceInterval = interval;
} else {
typingInterval = interval;
}
}

// 結果計算（改良版 - タイピング予測変換対応）
function calculateResults(inputText, sampleText, duration) {
const inputChars = inputText.length;
const speed = Math.round((inputChars / duration) * 60);

// タイピングの場合は意味的な比較を行う
let errors = 0;

// 単語レベルでの比較（予測変換を考慮）
const inputWords = inputText.replace(/[、。！？]/g, ' ').split(/\s+/).filter(word => word.length > 0);
const sampleWords = sampleText.replace(/[、。！？]/g, ' ').split(/\s+/).filter(word => word.length > 0);

// より柔軟な誤差計算
errors = calculateSmartErrors(inputWords, sampleWords);

const maxLength = Math.max(inputWords.length, sampleWords.length);
const accuracy = maxLength > 0 ? Math.max(0, Math.round(((maxLength - errors) / maxLength) * 100)) : 0;

return {
speed: speed,
accuracy: Math.max(0, accuracy),
errors: errors,
inputLength: inputChars,
duration: duration
};
}

// スマートエラー計算（予測変換を考慮）
function calculateSmartErrors(inputWords, sampleWords) {
let errors = 0;
const maxLength = Math.max(inputWords.length, sampleWords.length);

for (let i = 0; i < maxLength; i++) {
const inputWord = inputWords[i] || '';
const sampleWord = sampleWords[i] || '';

if (inputWord !== sampleWord) {
// 同じ意味の単語かチェック（例：ひらがな・カタカナ・漢字の違い）
if (!isSimilarWord(inputWord, sampleWord)) {
errors++;
}
}
}

return errors;
}

// 類似単語判定（予測変換での表記揺れを許容）
function isSimilarWord(word1, word2) {
if (!word1 || !word2) return false;

// 完全一致
if (word1 === word2) return true;

// ひらがな・カタカナ変換での一致
const hiragana1 = toHiragana(word1);
const hiragana2 = toHiragana(word2);
if (hiragana1 === hiragana2) return true;

// 長音記号の違いを許容（例：コンピューター vs コンピュータ）
const normalized1 = word1.replace(/ー/g, '');
const normalized2 = word2.replace(/ー/g, '');
if (normalized1 === normalized2) return true;

// 送り仮名の違いを許容
if (word1.length > 2 && word2.length > 2) {
const base1 = word1.substring(0, word1.length - 1);
const base2 = word2.substring(0, word2.length - 1);
if (base1 === base2) return true;
}

return false;
}

// カタカナをひらがなに変換
function toHiragana(str) {
return str.replace(/[\u30a1-\u30f6]/g, function(match) {
const chr = match.charCodeAt(0) - 0x60;
return String.fromCharCode(chr);
});
}

// 結果表示
function displayResults(type, results) {
document.getElementById(type + 'Speed').textContent = results.speed;
document.getElementById(type + 'Accuracy').textContent = results.accuracy + '%';
document.getElementById(type + 'Errors').textContent = results.errors;
document.getElementById(type + 'Results').style.display = 'block';
}

// 比較結果チェック
function checkComparison() {
if (voiceResults && typingResults) {
showComparison();
}
}

// 比較結果表示
function showComparison() {
const comparison = document.getElementById('comparison');
const content = document.getElementById('comparisonContent');

const speedDiff = voiceResults.speed - typingResults.speed;
const accuracyDiff = voiceResults.accuracy - typingResults.accuracy;

let recommendation = '';

if (speedDiff > 20 && accuracyDiff > -10) {
recommendation = '🎤 音声入力がおすすめ！速度が大幅に向上し、精度も十分です。';
} else if (speedDiff > 0 && accuracyDiff < -20) {
recommendation = '⚖️ 音声入力は速いですが、誤認識が多めです。短文や下書きに活用しましょう。';
} else if (speedDiff < -10) {
recommendation = '⌨️ タイピングの方が効率的です。音声入力の練習を続けて再チャレンジしてみましょう。';
} else {
recommendation = '📊 両方とも同程度の性能です。用途に応じて使い分けることをおすすめします。';
}

content.innerHTML = `
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
<div style="background: rgba(79, 70, 229, 0.1); padding: 15px; border-radius: 10px;">
<h4 style="color: #4f46e5; margin-bottom: 10px;">🎤 音声入力</h4>
<p>速度: ${voiceResults.speed} 文字/分</p>
<p>精度: ${voiceResults.accuracy}%</p>
<p>誤認識: ${voiceResults.errors} 箇所</p>
</div>
<div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 10px;">
<h4 style="color: #10b981; margin-bottom: 10px;">⌨️ タイピング</h4>
<p>速度: ${typingResults.speed} 文字/分</p>
<p>精度: ${typingResults.accuracy}%</p>
<p>誤入力: ${typingResults.errors} 箇所</p>
</div>
</div>

<div style="background: rgba(245, 158, 11, 0.1); padding: 20px; border-radius: 10px; text-align: center;">
<h4 style="color: #d97706; margin-bottom: 10px;">💡 生産性向上のためのアドバイス</h4>
<p style="font-size: 1.1rem; font-weight: 500;">${recommendation}</p>
</div>

<div style="margin-top: 20px; padding: 15px; background: rgba(99, 102, 241, 0.05); border-radius: 10px;">
<h4 style="color: #6366f1; margin-bottom: 10px;">📈 詳細分析</h4>
<p>速度差: ${speedDiff > 0 ? '+' : ''}${speedDiff} 文字/分 (音声入力が${speedDiff > 0 ? '速い' : '遅い'})</p>
<p>精度差: ${accuracyDiff > 0 ? '+' : ''}${accuracyDiff}% (音声入力が${accuracyDiff > 0 ? '正確' : '不正確'})</p>
</div>
`;

comparison.style.display = 'block';
}

// リセット機能
function resetVoiceTest() {
voiceTestActive = false;

if (voiceInterval) {
clearInterval(voiceInterval);
}

document.getElementById('voiceInput').value = '';
document.getElementById('voiceInput').readOnly = false;
document.getElementById('voiceResults').style.display = 'none';
document.getElementById('voiceTimer').textContent = '準備完了';
document.getElementById('voiceStartBtn').style.display = 'inline-flex';
document.getElementById('voiceStopBtn').style.display = 'none';
document.getElementById('voiceProgress').style.width = '0%';

updateVoiceStatus('ready');
voiceResults = null;
hideComparison();
}

function resetTypingTest() {
typingTestActive = false;

if (typingInterval) {
clearInterval(typingInterval);
}

document.getElementById('typingInput').value = '';
document.getElementById('typingInput').readOnly = false;
document.getElementById('typingResults').style.display = 'none';
document.getElementById('typingTimer').textContent = '準備完了';
document.getElementById('typingStartBtn').style.display = 'inline-flex';
document.getElementById('typingStopBtn').style.display = 'none';
document.getElementById('typingProgress').style.width = '0%';

typingResults = null;
hideComparison();
}

function hideComparison() {
if (!voiceResults || !typingResults) {
document.getElementById('comparison').style.display = 'none';
}
}

// ページ読み込み時の初期化
window.addEventListener('load', init);
</script>
</body>
</html>

